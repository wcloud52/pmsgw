
<!doctype html>
<html>
<head>
<title>比赛成绩列表</title>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1, user-scalable=no">
<link rel="stylesheet" href="/plugins/jquery-weui1.2.1/css/weui.css">
<link rel="stylesheet"
	href="/plugins/jquery-weui1.2.1/css/jquery-weui.css">
<link rel="stylesheet"
	href="/plugins/jquery-weui1.2.1/css/style.css?v=123">
<link rel="stylesheet" href="/plugins/jquery-weui/css/reset.css" />
<link rel="stylesheet" href="/plugins/jquery-weui/css/flex.css" />
<link rel="stylesheet" href="/plugins/jquery-weui/css/style.css" />

<link rel="stylesheet"
	href="/plugins/jquery-weui1.2.1/css/swiper.min.css" />

<script src="/plugins/jquery-weui1.2.1/js/zepto.js"></script>
<script src="/plugins/jquery-weui1.2.1/js/media.js"></script>
<style type="text/css">
.weui-table, table {
	width: 100%;
	border-collapse: collapse;
	background-color: #fff;
	line-height: 32px;
	text-align: center;
	border: none;
}

.weui-table th, table th {
	font-weight: 700
}

.weui-table a, table a {
	color: #18B4ED;
}

.weui-table td, .weui-table th, table td, table th {
	border: 1px solid #e0e0e0;
	text-align: left;
	line-height: 25px;
	padding: 8px;
}

.weui-table tr:hover, able tr:hover {
	background: #F7F7F7;
}

.weui-table-2n tr:nth-child(2n) {
	background-color: #F7F7F7;
}

@media only screen and (max-width: 767px) {
	.weui-table {
		border: none;
	}
	.weui-table  thead {
		display: none;
	}
	.weui-table tr {
		display: block;
		border-bottom: 1px solid #e0e0e0;
	}
	.weui-table td {
		display: block;
		text-align: right;
		line-height: 25px;
		border: none;
	}
	.weui-table td:last-child {
		border-bottom: none;
	}
	.weui-table td:before {
		content: attr(title);
		float: left;
		text-transform: uppercase;
		font-weight: bold;
	}
	.weui-table-2n tr:nth-child(2n) {
		background-color: transparent;
	}
}

html, body {
	position: relative;
	height: 100%;
}

body {
	background: #eee;
	font-family: Helvetica Neue, Helvetica, Arial, sans-serif;
	font-size: 14px;
	color: #000;
	margin: 0;
	padding: 0;
}

.swiper-container {
	width: 100%;
	height: 100%;
}

.swiper-slide {
	text-align: center;
	font-size: 18px;
	background: #fff;
	/* Center slide text vertically */
	display: -webkit-box;
	display: -ms-flexbox;
	display: -webkit-flex;
	display: flex;
	-webkit-box-pack: center;
	-ms-flex-pack: center;
	-webkit-justify-content: center;
	justify-content: center;
	-webkit-box-align: center;
	-ms-flex-align: center;
	-webkit-align-items: center;
	align-items: center;
}
</style>
</head>
<body>
	<section class="wrap">
		<section class="top-fixed">
			<div class="flex-box flex-between fs13 p8 top-search"
				style="background-color: #efeff4">
				<a href="myracelist" class="flex-box header_left"> <img
					src="/plugins/jquery-weui/images/header-img1.png" alt=""
					class="block header_back" style="height: 22px; margin-right: 4px;">
					<img src="/plugins/jquery-weui/images/header-img1.png" alt=""
					class="block header_options"
					style="height: 22px; margin-right: 4px;">
				</a>
				<div class="search-btn-wrap flex-grow-1 pointer">
					<i class="ico-search"></i> <input type="text" class=""
						placeholder="搜索您需要的成绩" id="searchInput">
				</div>
			</div>
		</section>
		<div class="p10 flex-box flex-between member-head"
			style="padding-top: 55px;">
			<div class="colf tc fs14 flex-box info">
				<p class="mr5" style="text-align: left">${master.game_cote_name}</p>
				<input type="hidden" id="req_game_cote_id"
					value="${master.game_cote_id}"> <input type="hidden"
					id="req_game_receiver_openid"
					value="${master.game_receiver_openid}">
			</div>
		</div>
		<section class="main" style="padding-top: 2px;">
			<div id="mainDiv">

				<!-- Swiper -->
				<div class="swiper-container">
					<div class="swiper-wrapper">
						<div class="swiper-slide" v-for="index2 in indexList">

							<table>
								<tbody>
									<tr v-for="item in racelist">
										<template v-for="(value, key, index) in item"> 
										<template v-if="index==0">
										<td width="200px">{{ value }}</td>
										</template> 
										<template v-if="index==index2+1">
										<td class="words">{{ value }}</td>
										</template> 
										</template>
									</tr>
								</tbody>
							</table>


						</div>
						

					</div>
					<!-- Add Arrows -->
					<div class="swiper-button-next"></div>
					<div class="swiper-button-prev"></div>
				</div>


				


			</div>


			<div class="weui-loadmore" id="loading">
				<i class="weui-loading"></i> <span class="weui-loadmore__tips">正在加载</span>
			</div>
		</section>


	</section>

	<script src="/plugins/jquery-weui1.2.1/js/jquery-2.1.4.js"></script>
	<script src="/plugins/jquery-weui1.2.1/js/jquery-weui.js"></script>
	<script src="/plugins/jquery-weui1.2.1/js/vue.js"></script>
	<script src="/plugins/jquery-weui/dist/js/swiper.min.js"></script>
	<script>
		var loading = false; //状态标记 这个变量主要是用来控制触发次数，官网也有说明，事件可能会触发多次

		var countPage = 1;//总页数
		var page = 1;//当前页
		var pageSize = 20;//每页显示几条
		//获取数据
		function init() {

			vueObj.bindRacelist(page, pageSize);
			page++;
		}

		$(document.body).infinite().on("infinite", function() {
			$("#loading").css("display", "block");//显示 加载中图标
			if (loading)
				return;
			loading = true;
			if (page <= countPage) {//如果当前页小于总页面
				init();
			} else {
				$(document.body).destroyInfinite();//到最后一页时，销毁它
				$("#loading>i").css("display", "none");
				$("#loading>span").html("到底啦~").css("color", "#BDBDBD");
			}
		});
		$('#searchInput').bind('input propertychange', function() {
			var text = $("#searchInput").val();
			vueObj.racelist = [];
			vueObj.searchInput = text;
			countPage = 1;//总页数
			page = 1;//当前页
			pageSize = 8;//每页显示几条
			init();

		});
		var vueObj = new Vue(
				{
					el : '#mainDiv',
					data : {
						racelist : [],
						indexList:[],
						searchInput : "",
						game_cote_id : $("#req_game_cote_id").val(),
						game_receiver_openid : $("#req_game_receiver_openid")
								.val()
					},
					methods : {
						bindRacelist : function(page, limit) {
							var _this = this;
							$
									.ajax({
										url : "/wap/data/myracedetaillist",
										data : {
											receiver_openid : _this.game_receiver_openid,
											cote_id : _this.game_cote_id,
											page : page,
											limit : limit,
											sort : "",
											fuzzyQuery : _this.searchInput
										},
										type : 'POST',
										contentType : "application/x-www-form-urlencoded; charset=UTF-8",
										dataType : 'json',
										async : true,
										success : function(ret) {
											if (ret.code == 0) {
												_this.racelist = _this.racelist.concat(ret.data);
												if(_this.racelist.length>0)
													{
												for(var ii=0;ii<Object.keys(_this.racelist[0]).length-1;ii++)
													{
													 _this.indexList.push(ii);
													}
													}
												
												
												
												
												loading = false;//会多次触发，所以 需要请求完成数据 才能继续触发

												$("#loading").css("display",
														"none");//数据加载完隐藏加载提示
											} else {

											}
										},
										error : function() {

											$.toast("网络超时，请再次尝试失败后联系管理员",
													"text");

										}
									});
						}
					}
				});
		init();
		vueObj.$nextTick(function () {
			var swiper = new Swiper('.swiper-container', {
				navigation : {
					nextEl : '.swiper-button-next',
					prevEl : '.swiper-button-prev',
					
				},
				observer:true,//修改swiper自己或子元素时，自动初始化swiper
				observeParents:true,//修改swiper的父元素时，自动初始化swiper
			});
          })
		
	</script>

</body>
</html>