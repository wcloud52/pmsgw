#前端性能优化

###**1、总述**

优化的目标有两点：

1. 减少加载时间；

2. 减少消耗流量；

正所谓时间就是金钱，流量 is Money，如果打开一个网页耗时过多，或者流量唰唰唰就没了，用户一定跟你say goodbye

这二者虽然是两个方向，但是有时候两个方向是互相包容的。

减少流量消耗，往往就能减少加载时间；而减少时间消耗，绝大多数也会间接带来流量消耗的减少。


###**2、页面**

####2.1 减少http请求数

**2.1.1 why**

既然谈减少，那么要谈为啥减少。这里copy个别人写的发起一次http请求干了些什么吧

1. 域名解析 -->
2. 发起TCP的3次握手 --> 
3. 建立TCP连接后发起http请求 --> 
4. 服务器响应http请求，浏览器得到html代码 --> 
5. 浏览器解析html代码，并请求html代码中的资源（如js、css、图片等） --> 
6. 浏览器对页面进行渲染呈现给用户

重点是第五步，对我们来说，请求一般指的就是js、css、图片的下载了。

第五步实质上是通过HTTP的keep-live模式来进行下载资源，资源数越多，需要请求的资源就越多（废话）。

这个行为是并发的，但是并发数是有限的（具体并发数不确定，但应该是个位数的，还记得不记得各种优化软件的优化浏览器并发数）。

所以假如需要下载资源的数目比较多，那么显然是要排队的，排队自然需要花的时间就多。

所以资源数越少（js、css、图片总数），那么加载时间就越少。

参考：

[一次完整的HTTP事务是怎样一个过程？](http://www.linux178.com/web/httprequest.html)

**2.1.2 how to do?**

1. 合并js、css。能用一个文件的就尽量不要用两个文件，具体可以用各种npm打包工具来干；
2. CSS图片合并。就是所谓的雪碧图，记得切图时尽量留个psd资源，方便日后修改；
3. 使用跨域。例如将静态文件放在一个域名下，动态内容放在另外一个域名下，然后静态资源禁用Cookie，可以起到减少数据传输的效果；
4. 使用HTTP/2。HTTP/2的特点是通过多路复用，只需要建立一个TCP链接，就可以同时收发多个文件。而且该连接还可以复用；

####2.2 减少DNS查询

**2.2.2 why**

**2.2.2 how to do?**


####2.3 避免重定向

####2.4 缓存ajax请求

####2.5 延迟加载

####2.6 与先加载

####2.7 减少DOM元素数量

####2.8 划分内容到不同域名

####2.9 减少iframe使用

####2.10 避免404错误

####2.11 定义字符集，并放在head顶部


####3.0 服务器

####3.1 使用CDN

####3.2 添加Expires或Cache-control响应头

####3.3 启用Gzip

####3.4 文件版本控制

####3.5 Ajax尽量使用get方法

####3.6 避免src和href使用空字符串

src可以使用javascript:void(0)，参见[javascript:void(0) 含义](http://www.runoob.com/js/js-void.html)

而href可以使用\<a href="#">这样的方法

###**4、Cookie**

####4.1 减少Cookie大小

####4.2 静态资源使用无Cookie域名

####4.3 可以考虑使用session（服务器），localstorage、sessionstorage（浏览器）

###**5、CSS**

####5.1 把样式表放在<head>中

####5.2 减少使用CSS表达式

####5.3 使用<link>替代@import

####5.4 不要使用IE的滤镜（不是指CSS3的）

###**6、JavaScript**

####6.1 把js的标签放在页面底部（如果js脚本写在script标签内）

####6.2 使用外部的JS脚本和CSS（就是指.js和.css文件）

####6.3 压缩JS和CSS（各种npm打包工具）

####6.4 移除重复脚本

####6.5 减少对ODM操作

####6.6 使用高效的事件处理（比如事件代理）

###**7、图片**

####7.1 优化图片和压缩图片

####7.2 雪碧图

####7.3 避免在HTML里缩放图片

####7.4 使用体积小、可缓存的favicon.ico（浏览器图标）